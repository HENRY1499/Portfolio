---
const listNav = [
  {
    name: "inicio",
  },
  {
    name: "proyectos",
  },
  {
    name: "experiencia",
  },
  {
    name: "contactame",
  },
];
---

<nav
  id="navbar"
  class="fixed top-4 w-fit left-[35%] z-10 rounded-full px-10 py-3 h-auto bg-[#92ADA4] shadow-md shadow-[#92ADA4] opacity-0 invisible"
>
  <div class="w-full flex items-center justify-between gap-4">
    {
      listNav.map((item) => (
        <span
          data-id={`${item.name}`}
          class="text-[#E9D7C0] hover:text-white hover:border-b hover:border-white cursor-pointer capitalize active:font-bold active:text-red-500"
        >
          {item.name}
        </span>
      ))
    }
  </div>
</nav>

<script>
  import gsap from "gsap";
  import ScrollTrigger from "gsap/ScrollTrigger";
  gsap.registerPlugin(ScrollTrigger);

  // Asegúrate de que esto ocurra **después** de que el DOM esté completamente cargado
  window.addEventListener("DOMContentLoaded", () => {
    const navbar = document.getElementById("navbar");
    const links = document.querySelectorAll("nav div span[data-id]");

    const sections =
      document.querySelectorAll(
        "section[id]"
      ); /*Selecciona todas las secciones que tienen el atributo id*/

    // Ocultamos inicialmente el navbar
    gsap.set(navbar, { autoAlpha: 0, display: "none" });

    sections.forEach((section) => {
      const id = section.getAttribute("id"); /*Obten el id de cada section*/

      links?.forEach((item) =>
        item.addEventListener("click", () => {
          const link = item.getAttribute("data-id");
          if (link)
            document
              .getElementById(link)
              ?.scrollIntoView({ behavior: "smooth" });
        })
      );
      ScrollTrigger.create({
        trigger: section,
        start: "top center",
        end: "bottom center",
        scrub: true,
        onEnter: () => {
          if (id === "proyectos") {
            gsap.to(navbar, {
              autoAlpha: 1,
              scale: 1,
              display: "flex",
              duration: 0.5,
            });
          }
        },
        onEnterBack: () => {
          if (id === "inicio") {
            gsap.to(navbar, {
              autoAlpha: 0,
              scale: 0,
              display: "none",
              duration: 0.5,
            });
          }
        },
      });
    });
  });
</script>
